<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

		<style>
body { padding-top: 70px; }
		</style>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>

		<script>
var serversocket = new WebSocket("ws://localhost:{{ .Port }}/logs");
serversocket.onmessage = function(e) {
	var d = JSON.parse(e.data);
	var x = $('#' + d.Key);
	if (x.length) {
		var html = "";
		if (d.Status == "Success") {
			html = '<span class="text-success"><i class="fa fa-check"></i></span>&nbsp;<small>(<a href="https://hearthreplay.com/g/' + d.Uploader + '/' + d.Key + '/">view</a>)</small>';
		} else {
			html = '<span class="text-danger"><i class="fa fa-close"></i>&nbsp;' + d.Reason + '</span>';
			if (d.Status == "Skipped") {
				html += '&nbsp;<small>(<a href="https://hearthreplay.com/g/' + d.Uploader + '/' + d.Key + '/">view</a>)</small>';
			}
		}
		$('#' + d.Key + '-status').html(html);
	} else {
		var tr = $('<tr>').attr('id', d.Key);

		if (d.Playrs.local.Winner) {
			tr.attr('class', 'success');
		} else {
			tr.attr('class', 'danger');
		}

		tr.append($('<td>').html(d.Playrs.local.Hero));
		tr.append($('<td>').html('<span>' + d.Playrs.remote.Hero + '</span>&nbsp;<small class="text-muted">(' + d.Playrs.remote.Name + ')</span>'));
		tr.append($('<td>').html(d.Type));
		tr.append($('<td>').html(moment(d.Start).format("ddd, MMMM Do, h:mm a")));
		tr.append($('<td>').html(moment.duration(d.Duration / 1000000, 'milliseconds').humanize()));
		tr.append($('<td>').attr('id', d.Key + '-status').html('<i class="fa fa-spinner fa-spin"></i>'));

		$('#games').prepend(tr);
		if ($('#user_header').children().length == 0) {
			$('#user_header').html('<a href="https://hearthreplay.com/g/' + d.Uploader + '/">View List of Your Games</a>');
		}
	}
};
serversocket.onclose = function(e) {
	$('#footer').append($('<h3>').text("Finished"));
};
		</script>
	</head>
	<body>
		<div class="navbar navbar-inverse navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="/">Hearthreplay Client</a>
				</div>
				<ul class="nav navbar-nav navbar-right">
					<li class="navbar-text">Version: {{ .Version }}</li>
				</ul>
			</div>
		</div>
		<div class="container">
			<div id="user_header" class="text-center">
				{{ if .Player }}
				<a href="https://hearthreplay.com/g/{{ .Player }}/">View List of Your Games</a>
				{{ end }}
			</div>
			<h3>This Session:</h3>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>As</th>
						<th>Against</th>
						<th>Type</th>
						<th>Start</th>
						<th>Length</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody id="games">
				</tbody>
			</table>
			<div id="footer" class="text-center">
			</div>
		</div>
	</body>
</html>
